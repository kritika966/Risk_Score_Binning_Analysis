<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Rule-Based Data Binning for Credit Risk Modeling in R</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="R_Tutorial_files/libs/clipboard/clipboard.min.js"></script>
<script src="R_Tutorial_files/libs/quarto-html/quarto.js"></script>
<script src="R_Tutorial_files/libs/quarto-html/popper.min.js"></script>
<script src="R_Tutorial_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="R_Tutorial_files/libs/quarto-html/anchor.min.js"></script>
<link href="R_Tutorial_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="R_Tutorial_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="R_Tutorial_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="R_Tutorial_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="R_Tutorial_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article toc-left">
<div id="quarto-sidebar-toc-left" class="sidebar toc-left">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Contents</h2>
   
  <ul>
  <li><a href="#introduction-to-binning" id="toc-introduction-to-binning" class="nav-link active" data-scroll-target="#introduction-to-binning">Introduction to Binning</a>
  <ul class="collapse">
  <li><a href="#why-do-we-use-binning" id="toc-why-do-we-use-binning" class="nav-link" data-scroll-target="#why-do-we-use-binning">Why Do We Use Binning?</a></li>
  <li><a href="#importance-of-binning-in-risk-analysis" id="toc-importance-of-binning-in-risk-analysis" class="nav-link" data-scroll-target="#importance-of-binning-in-risk-analysis">Importance of Binning in Risk Analysis</a></li>
  </ul></li>
  <li><a href="#loading-libraries-and-data" id="toc-loading-libraries-and-data" class="nav-link" data-scroll-target="#loading-libraries-and-data">Loading Libraries and Data</a>
  <ul class="collapse">
  <li><a href="#load-required-libraries-load-required-libraries" id="toc-load-required-libraries-load-required-libraries" class="nav-link" data-scroll-target="#load-required-libraries-load-required-libraries">Load Required Libraries {#Load Required Libraries}</a></li>
  <li><a href="#load-dataset" id="toc-load-dataset" class="nav-link" data-scroll-target="#load-dataset">Load Dataset</a></li>
  </ul></li>
  <li><a href="#binning-a-numeric-predictor-ext_source_1" id="toc-binning-a-numeric-predictor-ext_source_1" class="nav-link" data-scroll-target="#binning-a-numeric-predictor-ext_source_1">Binning a Numeric Predictor (EXT_SOURCE_1)</a>
  <ul class="collapse">
  <li><a href="#importance-of-this-distribution" id="toc-importance-of-this-distribution" class="nav-link" data-scroll-target="#importance-of-this-distribution">Importance of this Distribution:</a></li>
  <li><a href="#visualize-binned-variable" id="toc-visualize-binned-variable" class="nav-link" data-scroll-target="#visualize-binned-variable">Visualize Binned Variable</a></li>
  </ul></li>
  <li><a href="#default-rate-analysis-by-risk-group" id="toc-default-rate-analysis-by-risk-group" class="nav-link" data-scroll-target="#default-rate-analysis-by-risk-group">Default Rate Analysis by Risk Group</a>
  <ul class="collapse">
  <li><a href="#calculate-default-rates" id="toc-calculate-default-rates" class="nav-link" data-scroll-target="#calculate-default-rates">Calculate Default Rates</a></li>
  <li><a href="#visualize-default-rate" id="toc-visualize-default-rate" class="nav-link" data-scroll-target="#visualize-default-rate">Visualize Default Rate</a></li>
  </ul></li>
  <li><a href="#statistical-testing" id="toc-statistical-testing" class="nav-link" data-scroll-target="#statistical-testing">Statistical Testing</a>
  <ul class="collapse">
  <li><a href="#chi-square-test" id="toc-chi-square-test" class="nav-link" data-scroll-target="#chi-square-test">Chi-Square Test</a></li>
  </ul></li>
  <li><a href="#logistic-regression-using-binned-variable" id="toc-logistic-regression-using-binned-variable" class="nav-link" data-scroll-target="#logistic-regression-using-binned-variable">Logistic Regression Using Binned Variable</a>
  <ul class="collapse">
  <li><a href="#prepare-data-for-modeling" id="toc-prepare-data-for-modeling" class="nav-link" data-scroll-target="#prepare-data-for-modeling">Prepare Data for Modeling</a></li>
  <li><a href="#build-logistic-regression-model" id="toc-build-logistic-regression-model" class="nav-link" data-scroll-target="#build-logistic-regression-model">Build Logistic Regression Model</a></li>
  </ul></li>
  <li><a href="#predict-default-probability-for-a-high-score-low-risk-of-defaulting-example" id="toc-predict-default-probability-for-a-high-score-low-risk-of-defaulting-example" class="nav-link" data-scroll-target="#predict-default-probability-for-a-high-score-low-risk-of-defaulting-example">Predict Default Probability for a High-Score (Low-Risk of Defaulting) Example</a></li>
  <li><a href="#key-takeaway" id="toc-key-takeaway" class="nav-link" data-scroll-target="#key-takeaway">Key Takeaway</a></li>
  </ul>
</nav>
</div>
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar zindex-bottom">
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Rule-Based Data Binning for Credit Risk Modeling in R</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="introduction-to-binning" class="level1">
<h1>Introduction to Binning</h1>
<p>Binning is a fundamental data preprocessing technique used across various data science, machine learning, and statistical modeling tasks. It involves converting continuous numeric variables into discrete categories or intervals known as “bins.” This approach is commonly applied in:</p>
<ul>
<li><p><strong>Customer segmentation</strong></p></li>
<li><p><strong>Marketing analytics</strong></p></li>
<li><p><strong>Sensor data analysis</strong></p></li>
<li><p><strong>Medical data grouping</strong></p></li>
<li><p><strong>Financial risk modeling</strong></p></li>
</ul>
<section id="why-do-we-use-binning" class="level2">
<h2 class="anchored" data-anchor-id="why-do-we-use-binning">Why Do We Use Binning?</h2>
<p>Binning helps address challenges when continuous data is complex, noisy, or difficult to interpret. General benefits include:</p>
<ul>
<li><p>Converts detailed numeric values into understandable categories—for Example, High, Medium, and Low.</p></li>
<li><p>Minimizes the influence of extreme values or anomalies.</p></li>
<li><p>Allows business users and non-technical stakeholders to easily interpret results.</p></li>
<li><p>It helps break data into meaningful groups for targeted strategies.</p></li>
<li><p>Missing values can be categorized and analyzed separately.</p></li>
</ul>
</section>
<section id="importance-of-binning-in-risk-analysis" class="level2">
<h2 class="anchored" data-anchor-id="importance-of-binning-in-risk-analysis">Importance of Binning in Risk Analysis</h2>
<p>In financial and credit risk analysis, binning is critical because risk scores or predictive model outputs are often continuous but need to be:</p>
<ul>
<li><p>Explained to non-technical stakeholders.</p></li>
<li><p>Used for rule-based decision-making (e.g., “Reject if High Risk”) and flagging based on Risk analysis.</p></li>
</ul>
<p>Grouped to compare default rates or risk levels.</p>
<p>In the <strong>Home Credit Default Risk dataset</strong>, binning external risk scores like EXT_SOURCE_1 helps:</p>
<ul>
<li><p>Simplify complex numeric data.</p></li>
<li><p>Segment customers by risk level (Low, Medium, High)</p></li>
<li><p>Analyze default rates across groups.</p></li>
<li><p>Handle missing risk scores properly.</p></li>
</ul>
</section>
</section>
<section id="loading-libraries-and-data" class="level1">
<h1>Loading Libraries and Data</h1>
<section id="load-required-libraries-load-required-libraries" class="level2">
<h2 class="anchored" data-anchor-id="load-required-libraries-load-required-libraries">Load Required Libraries {#Load Required Libraries}</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  <span class="co"># for data manipulation</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readr)      <span class="co"># for reading csv</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-dataset" class="level2">
<h2 class="anchored" data-anchor-id="load-dataset">Load Dataset</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Replace the file path with your dataset location</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"application_train.csv"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Preview the data</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(<span class="fu">select</span>(data, EXT_SOURCE_1, TARGET))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 307,511
Columns: 2
$ EXT_SOURCE_1 &lt;dbl&gt; 0.08303697, 0.31126731, NA, NA, NA, NA, 0.77476141, NA, 0…
$ TARGET       &lt;dbl&gt; 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, …</code></pre>
</div>
</div>
</section>
</section>
<section id="binning-a-numeric-predictor-ext_source_1" class="level1">
<h1>Binning a Numeric Predictor (EXT_SOURCE_1)</h1>
<p>Convert the numeric predictor into categories <strong>Low, Medium, High</strong>, and <strong>Missing</strong> if NA.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Define a binning function</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>bin_ext_source <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.na</span>(x)) {</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Missing"</span>)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (x <span class="sc">&lt;=</span> <span class="fl">0.3</span>) {</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Low"</span>)</span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> <span class="cf">if</span> (x <span class="sc">&lt;=</span> <span class="fl">0.7</span>) {</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"Medium"</span>)</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(<span class="st">"High"</span>)</span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply the function to create a new binned column</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">EXT_SOURCE_1_BINNED =</span> <span class="fu">sapply</span>(EXT_SOURCE_1, bin_ext_source))</span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the counts in each bin</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(data<span class="sc">$</span>EXT_SOURCE_1_BINNED)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
   High     Low  Medium Missing 
  28764   27459   77910  173378 </code></pre>
</div>
</div>
<ul>
<li><p><strong>High Score Group (28,764 clients)</strong>: These are customers with EXT_SOURCE_1 scores above 0.7. <strong>They are low-risk clients</strong> expected to have a low probability of default.</p></li>
<li><p><strong>Low Score Group (27,459 clients)</strong>: Customers with EXT_SOURCE_1 scores less than or equal to 0.3. <strong>These are high-risk clients more likely to default.</strong></p></li>
<li><p><strong>Medium Score Group (77,910 clients)</strong>: Moderate-risk customers with scores between 0.3 and 0.7.</p></li>
</ul>
<p><strong>Missing (173,378 clients)</strong>: A significant number of clients have missing EXT_SOURCE_1 values. This group needs careful handling as missing could:</p>
<ul>
<li><p>Contain hidden risk</p></li>
<li><p>Be due to data collection issues</p></li>
</ul>
<section id="importance-of-this-distribution" class="level3">
<h3 class="anchored" data-anchor-id="importance-of-this-distribution">Importance of this Distribution:</h3>
<ul>
<li><p>The <strong>“Missing” bin dominates</strong> the dataset, raising questions:</p>
<ul>
<li><p>Should we treat missing as high-risk or low-risk?</p></li>
<li><p>Does missing correlate with default behavior?</p></li>
</ul></li>
<li><p>Proper treatment of this group is crucial in credit scoring models. It can be done using Sensitivity Analysis / Modeling Scenarios:</p>
<p><strong>Scenario 1:</strong> Treat Missing as a medium-risk group (keep it).</p>
<p><strong>Scenario 2:</strong> Run the model excluding Missing and compare results.</p>
<p><strong>Scenario 3:</strong> Impute missing values if external sources are available.</p></li>
</ul>
</section>
<section id="visualize-binned-variable" class="level2">
<h2 class="anchored" data-anchor-id="visualize-binned-variable">Visualize Binned Variable</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(<span class="at">x =</span> EXT_SOURCE_1_BINNED)) <span class="sc">+</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">fill =</span> <span class="st">"skyblue"</span>) <span class="sc">+</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Binned EXT_SOURCE_1 Distribution"</span>, <span class="at">x =</span> <span class="st">"EXT_SOURCE_1 Bin"</span>, <span class="at">y =</span> <span class="st">"Count"</span>) <span class="sc">+</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="default-rate-analysis-by-risk-group" class="level1">
<h1>Default Rate Analysis by Risk Group</h1>
<section id="calculate-default-rates" class="level2">
<h2 class="anchored" data-anchor-id="calculate-default-rates">Calculate Default Rates</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>default_rate <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(EXT_SOURCE_1_BINNED) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">DefaultRate =</span> <span class="fu">mean</span>(TARGET, <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">Count =</span> <span class="fu">n</span>())</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>default_rate</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4 × 3
  EXT_SOURCE_1_BINNED DefaultRate  Count
  &lt;chr&gt;                     &lt;dbl&gt;  &lt;int&gt;
1 High                     0.0306  28764
2 Low                      0.145   27459
3 Medium                   0.0667  77910
4 Missing                  0.0852 173378</code></pre>
</div>
</div>
<ul>
<li><p><strong>High Score Group</strong> (28,764 clients): Low-risk group with the lowest default rate (3%).</p></li>
<li><p><strong>Low Score Group</strong> (27,459 clients): High-risk group with the highest default rate (14.5%).</p></li>
<li><p><strong>Medium Group</strong> (77,910 clients): Moderate risk with a 6.7% default rate.</p></li>
<li><p><strong>Missing Group</strong> (173,378 clients): Default rate of 8.5%, higher than medium and high groups, suggesting some hidden risk.</p></li>
</ul>
</section>
<section id="visualize-default-rate" class="level2">
<h2 class="anchored" data-anchor-id="visualize-default-rate">Visualize Default Rate</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(default_rate, <span class="fu">aes</span>(<span class="at">x =</span> EXT_SOURCE_1_BINNED, <span class="at">y =</span> DefaultRate, <span class="at">fill =</span> EXT_SOURCE_1_BINNED)) <span class="sc">+</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">"identity"</span>) <span class="sc">+</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Default Rate by EXT_SOURCE_1 Risk Bin"</span>, <span class="at">x =</span> <span class="st">"Risk Group"</span>, <span class="at">y =</span> <span class="st">"Default Rate"</span>) <span class="sc">+</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="R_Tutorial_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Key Insight:</p>
<ul>
<li><p>Clear evidence that lower external scores correlate with higher default risk.</p></li>
<li><p>Missing group requires special attention due to its size and relatively high default rate.</p></li>
</ul>
</section>
</section>
<section id="statistical-testing" class="level1">
<h1>Statistical Testing</h1>
<section id="chi-square-test" class="level2">
<h2 class="anchored" data-anchor-id="chi-square-test">Chi-Square Test</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>chisq_test <span class="ot">&lt;-</span> <span class="fu">chisq.test</span>(<span class="fu">table</span>(data<span class="sc">$</span>EXT_SOURCE_1_BINNED, data<span class="sc">$</span>TARGET))</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>chisq_test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  table(data$EXT_SOURCE_1_BINNED, data$TARGET)
X-squared = 2746.7, df = 3, p-value &lt; 2.2e-16</code></pre>
</div>
</div>
<ul>
<li><p>The chi-square test is highly significant (p &lt; 2.2e-16), confirming that default rates differ significantly across the risk bins.</p></li>
<li><p>Strong statistical evidence that the binning strategy is meaningful in separating risk levels.</p></li>
</ul>
</section>
</section>
<section id="logistic-regression-using-binned-variable" class="level1">
<h1>Logistic Regression Using Binned Variable</h1>
<p>The logistic regression model is built to:</p>
<ul>
<li><p><strong>Quantify the impact</strong> of each risk bin (Low, Medium, High, Missing) on the probability of default.</p></li>
<li><p><strong>Validate binning effectiveness</strong> by checking if the groups significantly differ in predicting default.</p></li>
<li><p><strong>Support risk-based decision-making</strong> by estimating how much safer or riskier one group is compared to another.</p></li>
<li><p><strong>Handle binary outcomes</strong> like default (TARGET=1) or non-default (TARGET=0), which logistic regression is designed for.</p></li>
</ul>
<section id="prepare-data-for-modeling" class="level2">
<h2 class="anchored" data-anchor-id="prepare-data-for-modeling">Prepare Data for Modeling</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">EXT_SOURCE_1_BINNED =</span> <span class="fu">factor</span>(EXT_SOURCE_1_BINNED, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>, <span class="st">"Missing"</span>)))</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>model_data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> <span class="fu">select</span>(TARGET, EXT_SOURCE_1_BINNED) <span class="sc">%&gt;%</span> <span class="fu">drop_na</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="build-logistic-regression-model" class="level2">
<h2 class="anchored" data-anchor-id="build-logistic-regression-model">Build Logistic Regression Model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>model_binned <span class="ot">&lt;-</span> <span class="fu">glm</span>(TARGET <span class="sc">~</span> EXT_SOURCE_1_BINNED, <span class="at">data =</span> model_data, <span class="at">family =</span> <span class="st">"binomial"</span>)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_binned)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
glm(formula = TARGET ~ EXT_SOURCE_1_BINNED, family = "binomial", 
    data = model_data)

Coefficients:
                           Estimate Std. Error z value Pr(&gt;|z|)    
(Intercept)                -1.77600    0.01715 -103.56   &lt;2e-16 ***
EXT_SOURCE_1_BINNEDMedium  -0.86203    0.02236  -38.54   &lt;2e-16 ***
EXT_SOURCE_1_BINNEDHigh    -1.68106    0.03831  -43.88   &lt;2e-16 ***
EXT_SOURCE_1_BINNEDMissing -0.59776    0.01919  -31.16   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

(Dispersion parameter for binomial family taken to be 1)

    Null deviance: 172542  on 307510  degrees of freedom
Residual deviance: 169770  on 307507  degrees of freedom
AIC: 169778

Number of Fisher Scoring iterations: 6</code></pre>
</div>
</div>
<ul>
<li><p>The intercept represents the log-odds of default for the baseline “Low” risk group.</p></li>
<li><p><strong>Medium Group</strong>: Shows a significant negative coefficient (-0.86203), meaning less likelihood of default compared to the “Low” risk group.</p></li>
<li><p><strong>High Group</strong>: Strong negative coefficient (-1.68106), indicating very low default risk compared to “Low”.</p></li>
<li><p><strong>Missing Group</strong>: Also less risky than “Low” but riskier than “High” or “Medium”.</p></li>
</ul>
</section>
</section>
<section id="predict-default-probability-for-a-high-score-low-risk-of-defaulting-example" class="level1">
<h1>Predict Default Probability for a High-Score (Low-Risk of Defaulting) Example</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>new_client <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">EXT_SOURCE_1_BINNED =</span> <span class="fu">factor</span>(<span class="st">"High"</span>, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Medium"</span>, <span class="st">"High"</span>, <span class="st">"Missing"</span>)))</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">predict</span>(model_binned, <span class="at">newdata =</span> new_client, <span class="at">type =</span> <span class="st">"response"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         1 
0.03055903 </code></pre>
</div>
</div>
<p>A customer in the “High” score bin has only a 3.05% chance of defaulting, confirming the low-risk nature of this group.</p>
</section>
<section id="key-takeaway" class="level1">
<h1>Key Takeaway</h1>
<ul>
<li><p>Binning makes numeric scores explainable.</p></li>
<li><p>Low-score groups have significantly higher default risk.</p></li>
<li><p>Logistic regression confirms that “High” and “Medium” groups are safer.</p></li>
<li><p>The chi-square test and modeling validate binning as a strong strategy for risk prediction.</p></li>
<li><p><strong>Logistic regression quantifies the risk difference</strong> across bins, providing clear, actionable insights.</p></li>
<li><p>Binned variables improve modeling, decision-making, and communication with non-technical stakeholders.</p></li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>